# Мотивационный Telegram Bot

Этот бот написан на Python с использованием фреймворка aiogram. Бот собирает информацию о пользователях и помогает достигать целей через ежедневные задания. Поддерживает мультиязычность для русскоязычных пользователей и стран СНГ.

## Установка и запуск

### 1. Клонирование репозитория
```bash
git clone <repository-url>
cd lvlbot
```

### 2. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 3. Настройка токенов
Создайте файл `.env` в корневой директории проекта:
```env
BOT_TOKEN=ваш_токен_бота_здесь
OPENROUTER_API_KEY=ваш_openrouter_api_key_здесь
```

- **BOT_TOKEN**: получить у [@BotFather](https://t.me/BotFather) в Telegram
- **OPENROUTER_API_KEY**: получить на [openrouter.ai](https://openrouter.ai)

### 4. Запуск бота
```bash
python bot.py
```

## Структура проекта

- `bot.py` - основной файл бота с логикой диалога
- `database.py` - работа с базой данных SQLite
- `models.py` - модель данных пользователя
- `config.py` - конфигурация и переменные окружения
- `requirements.txt` - зависимости проекта

## Функциональность бота

### Команды
- `/start` - начать регистрацию или проверить статус
- `/update` - обновить данные пользователя
- `/cancel` - отменить текущую регистрацию
- `/help` - показать справку

### Процесс регистрации
Бот последовательно спрашивает:
1. **Язык** - выбор из 13 доступных языков (Русский, English, языки СНГ)
2. **Имя** - минимум 2 символа
3. **Дата рождения** - формат ДД.ММ.ГГГГ (например: 15.05.1990)
4. **Рост** - в сантиметрах (50-250 см)
5. **Вес** - в килограммах (3-300 кг)
6. **Город** - минимум 2 символа
7. **Реферальный код** - опционально, можно пропустить
8. **Главная цель** - описание цели пользователя (минимум 3 символа)
9. **Подтверждение цели** - пользователь может подтвердить, улучшить с помощью ИИ или изменить цель
10. **Выбор подписки** - выбор периода (1, 3, 6, 12 месяцев)
11. **Оплата** - интеграция с WATA для оплаты подписки

### Валидация данных
- Имя: минимум 2 символа
- Дата рождения: формат ДД.ММ.ГГГГ, не в будущем, возраст 10-120 лет
- Рост: 50-250 см
- Вес: 3-300 кг
- Город: минимум 2 символа
- Реферальный код: любой текст или "Пропустить"
- Цель: минимум 3 символа
- Подтверждение цели: интерактивные кнопки (Уверен/ИИ улучшение/Изменить)

### База данных
Используется SQLite для хранения данных пользователей. Таблица `users` содержит:
- `telegram_id` - уникальный ID пользователя Telegram
- `language` - предпочитаемый язык (код языка)
- `name` - имя пользователя
- `birth_date` - дата рождения (ISO формат)
- `height` - рост в см
- `weight` - вес в кг
- `city` - город
- `created_at` - дата создания записи
- `updated_at` - дата последнего обновления

## Использование

1. Запустите бота командой `python bot.py`
2. Найдите бота в Telegram и отправьте `/start`
3. Следуйте инструкциям бота для заполнения данных
4. Используйте `/update` для изменения данных
5. Используйте `/help` для получения справки

## Зависимости

- aiogram==3.13.1 - фреймворк для Telegram ботов
- aiosqlite==0.20.0 - асинхронная работа с SQLite
- python-dotenv==1.0.1 - загрузка переменных окружения
- aiohttp==3.9.1 - HTTP клиент для OpenRouter API

## API интеграции

### OpenRouter API

Бот использует OpenRouter API для улучшения формулировок целей с помощью ИИ. Настройки API находятся в файле `openrouter_config.py`:

- **Модель**: по умолчанию `openrouter/polaris-alpha` (можно изменить)
- **Системный промт**: настроен для мотивационных целей
- **API ключ**: хранится в переменной окружения `OPENROUTER_API_KEY`

### WATA API

Бот использует WATA API для обработки платежей. Настройки находятся в файле `subscription_config.py`:

- **Токен**: хранится в переменной окружения `WATA_TOKEN`
- **Тарифы подписки**: настраиваются в `SUBSCRIPTION_PLANS`
- **Проверка платежей**: автоматическая фоновая проверка каждые 30 секунд

## Лицензия

MIT License
