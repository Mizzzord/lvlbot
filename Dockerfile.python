# Dockerfile –¥–ª—è Python –±–æ—Ç–æ–≤
FROM python:3.11-slim

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
RUN apt-get update && apt-get install -y \
    gcc \
    sqlite3 \
    && rm -rf /var/lib/apt/lists/*

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
WORKDIR /app

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ requirements.txt –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ Python
COPY *.py ./

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
RUN mkdir -p player_cards player_photos task_submissions __pycache__

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
ENV PYTHONUNBUFFERED=1
ENV PYTHONPATH=/app

# –°–æ–∑–¥–∞–Ω–∏–µ entrypoint —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –æ–±–æ–∏—Ö –±–æ—Ç–æ–≤
RUN echo '#!/bin/bash\n\
echo "üöÄ –ó–∞–ø—É—Å–∫ Motivation Bot —Å–µ—Ä–≤–∏—Å–æ–≤..."\n\
\n\
# –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞ –≤ —Ñ–æ–Ω–µ\n\
python bot.py &\n\
BOT_PID=$!\n\
echo "üéØ –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –∑–∞–ø—É—â–µ–Ω (PID: $BOT_PID)"\n\
\n\
# –ó–∞–ø—É—Å–∫ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—Å–∫–æ–≥–æ –±–æ—Ç–∞ –≤ —Ñ–æ–Ω–µ\n\
python moderator_bot.py &\n\
MODERATOR_PID=$!\n\
echo "‚öîÔ∏è –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—Å–∫–∏–π –±–æ—Ç –∑–∞–ø—É—â–µ–Ω (PID: $MODERATOR_PID)"\n\
\n\
echo ""\n\
echo "‚úÖ –í—Å–µ Python –±–æ—Ç—ã –∑–∞–ø—É—â–µ–Ω—ã!"\n\
echo "üìã PID –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:"\n\
echo "  ‚Ä¢ –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç: $BOT_PID"\n\
echo "  ‚Ä¢ –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—Å–∫–∏–π –±–æ—Ç: $MODERATOR_PID"\n\
echo ""\n\
echo "üõë –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C"\n\
\n\
# –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤\n\
wait' > /app/start-bots.sh && chmod +x /app/start-bots.sh

# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
CMD ["/app/start-bots.sh"]
